import { Request, Response, NextFunction } from 'express';
import catchAsync from '../utils/catchAsync';
import { authService } from '../services/auth.service';
import { ApiResponse } from '../utils/apiResponse';

export const register = catchAsync(async (req: Request, res: Response) => {
  const { email, password, name } = req.body;

  const result = await authService.register({ email, password, name });

  res.status(201).json(
    new ApiResponse(201, result, 'User registered successfully')
  );
});

export const login = catchAsync(async (req: Request, res: Response) => {
  const { email, password } = req.body;

  const result = await authService.login(email, password);

  res.json(
    new ApiResponse(200, result, 'Login successful')
  );
});

export const getProfile = catchAsync(async (req: Request, res: Response) => {
  const user = req.user;

  res.json(
    new ApiResponse(200, { user }, 'Profile retrieved successfully')
  );
});

export const refreshToken = catchAsync(async (req: Request, res: Response) => {
  const { refreshToken } = req.body;

  const result = await authService.refreshToken(refreshToken);

  res.json(
    new ApiResponse(200, result, 'Token refreshed successfully')
  );
});